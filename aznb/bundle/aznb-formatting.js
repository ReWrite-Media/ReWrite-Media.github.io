(window.webpackJsonpAzureNotebooks=window.webpackJsonpAzureNotebooks||[]).push([[10],{"./src/features/formatting/async/index.ts":function(e,t,o){"use strict";o.r(t),o.d(t,"onLoad",(function(){return w})),o.d(t,"getKnownFormattingProviders",(function(){return p})),o.d(t,"getProviderPreferenceMap",(function(){return b})),o.d(t,"getPreferredFormattingProviderByLanguage",(function(){return v}));var n=o("./node_modules/tslib/tslib.es6.js"),r=o("./src/core/notebook/index.ts"),i=o("./src/core/config/selectors/index.ts"),s=o("./src/features/monaco/index.ts"),a=o("./node_modules/rxjs/operators/index.js"),c=o("./node_modules/typesafe-actions/dist/index.umd.js"),d=o("./node_modules/rxjs/index.js"),u=o("./src/core/notebook/selectors.ts"),g=[(e,t)=>e.pipe(Object(a.filter)(Object(c.isActionOf)(r.a.formatCell)),Object(a.withLatestFrom)(t),Object(a.switchMap)(([e,t])=>{const{contentRef:o,id:n}=e.payload,r=s.c.GlobalEditorManager.getEditor(s.a.Code,o,n);return null==r||r.trigger("","editor.action.formatDocument",{}),d.EMPTY})),(e,t)=>e.pipe(Object(a.filter)(Object(c.isActionOf)(r.a.formatNotebook)),Object(a.withLatestFrom)(t),Object(a.switchMap)(([e,t])=>{const{contentRef:o}=e.payload,n=Object(u.getCellOrder)(t,{contentRef:o});for(const e of n){const t=s.c.GlobalEditorManager.getEditor(s.a.Code,o,e);null==t||t.trigger("","editor.action.formatDocument",{})}return d.EMPTY})),(e,t)=>e.pipe(Object(a.filter)(Object(c.isActionOf)(r.a.setRegisterDocumentFormattingEditProvider)),Object(a.withLatestFrom)(t),Object(a.switchMap)(([e,t])=>{const o=Object(u.activeContentRef)(t);for(const n of Object(u.getCellOrder)(t,{contentRef:o})){const r=s.c.getCellLanguage(t,o,n);e.payload(o,n)(r)}return d.EMPTY}))],l=o("./node_modules/immutable/dist/immutable.es.js"),f=o("./src/features/formatting/featureConstants.ts");const m=e=>e.features[f.a];function p(e){var t;return null===(t=m(e))||void 0===t?void 0:t.knownProviders}function b(e){var t;return null===(t=m(e))||void 0===t?void 0:t.providerPreference}const v=(e,t)=>{const o=b(e);if(o&&o.has(t))return o.get(t)},j={};function O(e=j,t){switch(t.type){case Object(c.getType)(r.a.setKnownFormattingProviders):const o=t.payload;return Object.assign(Object.assign({},e),{knownProviders:o.providerMap});case Object(c.getType)(r.a.setPreferredFormattingProvider):const n=t.payload,i=e.providerPreference||l.default.Map();return Object.assign(Object.assign({},e),{providerPreference:i.set(n.languageId,n.providerId)});default:return e}}var x=o("./src/features/extensionHost/index.ts"),C=o("../extension-protocols/dist/index.js"),P=o("../extension-host/lib/index.js");const w=(e,t,o)=>Object(n.b)(void 0,void 0,void 0,(function*(){e.epicLoader.appendEpics(g),e.reducerLoader.appendReducer(f.a,O);const a=Object(i.getFormattingOptions)(t.getState()),c=(null==a?void 0:a.kind)||P.ExtensionHostKind.ServerCompute,d=x.b.getExtensionHostClient(c,o);if(!d)return void console.warn("Couldn't get an extension host client - it needs to be made a dependency");if(!(yield d.getExtensionOrder()).includes("aznb.formatting"))return void console.warn("Formatting extension wasn't loaded on remote server");const u=x.b.getContextCreator(o);if(!u)return void console.warn("Couldn't get context creator");!function(e,t,o){Object(n.b)(this,void 0,void 0,(function*(){const n=yield t.sendMessage(C.ClientToServerOps.Command,{commandName:"getFormattingProvidersInfo",commandCtx:e.getExtensionContextPayload()});if(n.execAction!==C.ExecActions.Message)throw new Error("Expected return type to be a message");const i=n.params,s={};for(const e of Object.keys(i)){s[e]=l.default.List();for(const t of i[e])s[e]=s[e].push(t)}o.dispatch(r.a.setKnownFormattingProviders({providerMap:l.default.Map(s)}))}))}(u,d,t);const m=((e,t,o)=>(r,i)=>r=>{s.c.languages.registerDocumentFormattingEditProvider(r,{provideDocumentFormattingEdits:(i,s,a)=>Object(n.b)(void 0,void 0,void 0,(function*(){const n=i.getValue(),s=v(o.getState(),r),c=Object.assign({language:r,textToFormat:n},s&&{providerPreference:s}),d=yield t.sendMessage(C.ClientToServerOps.Command,{commandName:"formatCode",commandArgs:c,commandCtx:e.getExtensionContextPayload()});if(!d||d.execAction!==C.ExecActions.Message)return[];const u=d.params,g=[{range:{startLineNumber:1,startColumn:1,endLineNumber:i.getLineCount(),endColumn:i.getLineMaxColumn(i.getLineCount())},text:u}];return a&&a.isCancellationRequested?[]:g}))})})(u,d,t);if(t.dispatch(r.a.setRegisterDocumentFormattingEditProvider(m)),null==a?void 0:a.providerPreference)for(const e of Object.keys(a.providerPreference))t.dispatch(r.a.setPreferredFormattingProvider({providerId:a.providerPreference[e].provider,languageId:e}))}))}}]);